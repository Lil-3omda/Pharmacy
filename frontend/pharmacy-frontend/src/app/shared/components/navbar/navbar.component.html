<mat-toolbar class="navbar" color="primary">
  <div class="navbar-container">
    <!-- Logo -->
    <div class="navbar-brand" routerLink="/home">
      <mat-icon class="brand-icon">local_pharmacy</mat-icon>
      <span class="brand-text">صيدلية الشفاء</span>
    </div>

    <!-- Desktop Navigation -->
    <nav class="navbar-nav desktop-nav">
      <a mat-button routerLink="/home" routerLinkActive="active">الرئيسية</a>
      <a mat-button routerLink="/products" routerLinkActive="active">المنتجات</a>
      <a mat-button routerLink="/offers" routerLinkActive="active">العروض</a>
      <a mat-button routerLink="/prescriptions" routerLinkActive="active" *ngIf="currentUser">الوصفات الطبية</a>
      <a mat-button routerLink="/orders" routerLinkActive="active" *ngIf="currentUser">طلباتي</a>
      <a mat-button routerLink="/admin" routerLinkActive="active" *ngIf="isAdmin()">لوحة التحكم</a>
    </nav>


    <!-- User Actions -->
    <div class="navbar-actions">
      <!-- Favorites -->
      <button mat-icon-button routerLink="/favorites" matTooltip="المفضلة" *ngIf="currentUser">
        <mat-icon>favorite</mat-icon>
      </button>

      <!-- Cart -->
      <button mat-icon-button routerLink="/cart" class="cart-button" *ngIf="currentUser">
        <mat-icon matBadge="{{cartItemCount}}" matBadgeColor="accent" [matBadgeHidden]="cartItemCount === 0">shopping_cart</mat-icon>
      </button>

      <!-- User Menu -->
      <div class="user-menu" *ngIf="currentUser; else loginButton">
        <button mat-button [matMenuTriggerFor]="userMenu" class="user-button">
          <mat-icon>account_circle</mat-icon>
          <span class="user-name">{{currentUser.fullName}}</span>
          <mat-icon>keyboard_arrow_down</mat-icon>
        </button>
        
        <mat-menu #userMenu="matMenu" xPosition="before">
          <button mat-menu-item routerLink="/profile">
            <mat-icon>person</mat-icon>
            <span>الملف الشخصي</span>
          </button>
          <button mat-menu-item routerLink="/orders">
            <mat-icon>receipt_long</mat-icon>
            <span>طلباتي</span>
          </button>
          <button mat-menu-item routerLink="/prescriptions">
            <mat-icon>description</mat-icon>
            <span>الوصفات الطبية</span>
          </button>
          <button mat-menu-item routerLink="/favorites">
            <mat-icon>favorite</mat-icon>
            <span>المفضلة</span>
          </button>
          <mat-divider></mat-divider>
          <button mat-menu-item (click)="logout()">
            <mat-icon>logout</mat-icon>
            <span>تسجيل الخروج</span>
          </button>
        </mat-menu>
      </div>

      <ng-template #loginButton>
        <button mat-raised-button color="accent" routerLink="/login">تسجيل الدخول</button>
      </ng-template>

      <!-- Mobile Menu Toggle -->
      <button mat-icon-button class="mobile-menu-toggle" (click)="toggleMenu()">
        <mat-icon>menu</mat-icon>
      </button>
    </div>
  </div>

  <!-- Mobile Navigation -->
  <div class="mobile-nav" [class.open]="isMenuOpen">
    <a mat-button routerLink="/home" (click)="toggleMenu()">الرئيسية</a>
    <a mat-button routerLink="/products" (click)="toggleMenu()">المنتجات</a>
    <a mat-button routerLink="/offers" (click)="toggleMenu()">العروض</a>
    <a mat-button routerLink="/prescriptions" (click)="toggleMenu()" *ngIf="currentUser">الوصفات الطبية</a>
    <a mat-button routerLink="/orders" (click)="toggleMenu()" *ngIf="currentUser">طلباتي</a>
    <a mat-button routerLink="/admin" (click)="toggleMenu()" *ngIf="isAdmin()">لوحة التحكم</a>
  </div>
</mat-toolbar>